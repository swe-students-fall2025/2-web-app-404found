{% extends "base.html" %} {% block container %}
<div class="h2-container">
  <h2>Latest Jobs</h2>
</div>

<form method="GET" action="{{ url_for('official_home') }}" class="search-bar">
  <input
    type="text"
    name="q"
    placeholder="Search jobs..."
    value="{{ request.args.get('q', '') }}"
  />
  <button type="submit">Search</button>
</form>

<div class="job-list">
  {% for job in jobs %}
  <div class="job-card">
    <h3>{{ job.title |safe}}</h3>
    <p><strong>Company:</strong> {{ job.company |safe }}</p>
    <p><strong>Date Posted:</strong> {{ job.datePosted }}</p>
    <p>
      <strong>Location:</strong>
      {% if job.location %} {{ job.location[:2] | join(', ') }} {% else %} N/A
      {% endif %}
    </p>
    {% if search %}
    <p><strong>Employment Type:</strong> {{ job.employmentType | safe}}</p>
    <p><strong>Description:</strong> {{ job.description|safe}}</p>
    <p><strong>Qualifications:</strong> {{ job.qualifications|safe}}</p>
    {% endif%}

    <div class="job-actions">
      <a
        href="{{ url_for('view_job', job_id=job['_id'], next='official_home') }}"
        class="btn-action btn-view"
      >
        View Details
      </a>

      <a href="{{ job['url'] }}" target="_blank" class="btn-action btn-apply"
        >Apply</a
      >
    </div>

    {% if job['_id'] in user_jobs %}
    <button class="btn added" disabled>âœ“ Added</button>
    {% else %}
    <form
      action="{{ url_for('add_to_my_jobs', job_id=job['_id']) }}"
      method="post"
    >
      <button class="btn">Add to My Jobs</button>
    </form>
    {% endif %}
  </div>
  {% endfor %}
</div>

<!-- Pagination controls -->
<div class="pagination">
  {% if page > 1 %}
  <div class="no-box">
    <a
      style="float: left; text-decoration: none"
      href="{{ url_for('official_home', page=page-1) }}"
      >Previous</a
    >
  </div>
  {% endif %} {% if has_next %}
  <div class="no-box">
    <a
      style="float: right; text-decoration: none"
      href="{{ url_for('official_home', page=page+1) }}"
      >Next</a
    >
  </div>
  {% endif %}
</div>
<script>
  if ("scrollRestoration" in history) {
    history.scrollRestoration = "manual";
  }

  // Restore scroll position only when coming BACK from a job detail
  const HEADER_OFFSET = 90; // adjust this to your header height (in px)

  const storedScroll = localStorage.getItem("scrollPosition");
  if (storedScroll) {
    const target = Math.max(parseInt(storedScroll) - HEADER_OFFSET, 0);
    window.scrollTo({ top: target, behavior: "smooth" });
    localStorage.removeItem("scrollPosition");
  }

  // Save scroll position only when clicking "View Details"
  document.querySelectorAll(".btn-view").forEach((btn) => {
    btn.addEventListener("click", () => {
      localStorage.setItem("scrollPosition", window.scrollY);
    });
  });

  // For pagination: always scroll to top when clicking next/prev
  document.querySelectorAll(".pagination a").forEach((link) => {
    link.addEventListener("click", () => {
      // clear any stored scroll so back won't trigger restore
      localStorage.removeItem("scrollPosition");
      window.scrollTo({ top: 0, behavior: "smooth" });
    });
  });
</script>

{% endblock %}
